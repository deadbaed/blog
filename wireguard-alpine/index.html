<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Setup WireGuard server on Alpine Linux &middot; deadbaed</title>
    <meta name="description" content="broke my bed now it&amp;#x27;s dead" />
    <link rel="shortcut icon"  href="https://blog.x4m3.rocks/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="https://blog.x4m3.rocks/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://blog.x4m3.rocks/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://blog.x4m3.rocks/favicon-16x16.png">
    <link rel="mask-icon" href="https://blog.x4m3.rocks/safari-pinned-tab.svg" color="#5bbad5">

    <link rel="alternate" type="application/atom+xml" title="RSS" href="https://blog.x4m3.rocks/atom.xml">

    <style>html,body{background:#fffaf7;color:#2d2d2d;font:16px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}a,a:visited{color:darkred;text-decoration:none}a:hover{text-decoration:underline}main{margin:auto;max-width:38rem;padding:.8rem}pre{background:#fff;overflow:scroll;padding:1rem}td{border:1px solid #2d2d2d;padding:10px}img{height:auto;max-width:100%}.homepage-list{list-style:none;padding:1rem 0}.homepage-list li{align-items:center;display:flex;flex-wrap:wrap;justify-content:space-between;margin-bottom:10px}@media (max-width: 38rem){.homepage-list li a{width:100%}}</style>

    <meta property="og:site_name" content="deadbaed">
      
      <meta property="og:title" content="Setup WireGuard server on Alpine Linux">
      <meta property="og:description" content="">
      <meta property="og:url" content="https://blog.x4m3.rocks/wireguard-alpine/">
      <meta property="og:image" content="">

      <meta property="og:type" content="article" />
        <meta property="article:published_time" content="2023-06-24T00:00:00+00:00" />

      
      
    

    <script defer data-domain="blog.x4m3.rocks" src="https://plausible.y.z.x4m3.rocks/js/script.js"></script>
  </head>
  

  <body>
    <main id="main" role="main">

      
      <header role="banner">
        <h3 style="margin-top:0;">
          <a href="https://blog.x4m3.rocks" title="Home">deadbaed</a>
          <br /><small>broke my bed now it&#x27;s dead</small>
        </h3>

        <div class="search-container">
          <input type="text" id="search" placeholder="Search..." style="width: 100%;">
          <div class="search-results">
            <div class="search-results__items"></div>
          </div>
        </div>
      </header>
      <hr />
      

      
<article>
  <h1>Setup WireGuard server on Alpine Linux</h1>

  
    <p style="font-size:90%;">Posted on <time datetime="2023-06-24T00:00:00+00:00">June 24, 2023</time></p>
  

  <p>Let's do this baremetal, no Docker!</p>
<p>I will do this inside a <a href="https://www.proxmox.com/en/">Proxmox</a> virtual machine.</p>
<h1 id="get-started">Get started</h1>
<p>Start by installing <a href="https://www.alpinelinux.org/">Alpine Linux</a>: Run the installer, next, next, next, and boot the os once it's done.</p>
<h1 id="setup-ssh">Setup ssh</h1>
<p>Copy ssh key (run this on your local machine):</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">ssh-copy-id -i ~/.ssh/id_rsa.pub user@ip
</span></code></pre>
<p>Login via ssh, and install your favorite editor:</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">doas apk add vim
</span></code></pre>
<p>Edit ssh config to force ssh key use:</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">doas vim /etc/ssh/sshd_config
</span></code></pre>
<p>Find and update these statements:</p>
<pre style="background-color:#fcf0ca;color:#282828aa;"><code><span>PermitRootLogin no
</span><span>PubkeyAuthentication yes
</span></code></pre>
<p>Restart ssh service, logout, and log back in</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">doas rc-service sshd restart
</span></code></pre>
<h1 id="setup-alpine-package-manager">Setup alpine package manager</h1>
<p>I use <code>mirrors.ircam.fr</code> as my mirror</p>
<p>Open </p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">/etc/apk/repositories
</span></code></pre>
<p>add the community repo, and run updates:</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">doas apk -U upgrade
</span></code></pre>
<h1 id="wireguard-basics">WireGuard basics</h1>
<p>Install WireGuard:</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">doas apk add wireguard-tools
</span></code></pre>
<h2 id="kernel-module">Kernel module</h2>
<p>Load the module</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">doas modprobe wireguard
</span></code></pre>
<p>To launch the module on startup, edit</p>
<pre style="background-color:#fcf0ca;color:#282828aa;"><code><span>/etc/modules
</span></code></pre>
<p>and simply add</p>
<pre style="background-color:#fcf0ca;color:#282828aa;"><code><span>wireguard
</span></code></pre>
<p>at the bottom, and save the file.</p>
<h2 id="ip-forwarding">IP forwarding</h2>
<p>Edit</p>
<pre style="background-color:#fcf0ca;color:#282828aa;"><code><span>/etc/sysctl.conf
</span></code></pre>
<p>and add</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">net.ipv4.ip_forward = 1
</span></code></pre>
<p>at the bottom of the file, and save</p>
<p>Launch sysctl on startup with</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">doas rc-update add sysctl
</span></code></pre>
<p>and reboot.</p>
<h1 id="ip-addresses">IP Addresses</h1>
<p>Pick a range if ip addresses to use: <a href="https://datatracker.ietf.org/doc/html/rfc1918">RFC 1918</a></p>
<p>I'll pick <code>10.131.111.x</code> for the WireGuard peers.</p>
<p>Calculate your CIDR: <a href="https://www.ipaddressguide.com/cidr">https://www.ipaddressguide.com/cidr</a></p>
<p>Here's my network layout:</p>
<ul>
<li>CIDR: <code>10.131.110.0/23</code></li>
<li>Start: <code>10.131.110.0</code></li>
<li>End: <code>10.131.111.255</code></li>
</ul>
<p>Network services:</p>
<ul>
<li>Start: <code>10.131.110.0/24</code></li>
<li>End: <code>10.131.110.255/24</code></li>
</ul>
<p>WireGuard:</p>
<ul>
<li>Start: <code>10.131.111.0/24</code></li>
<li>End: <code>10.131.111.255/24</code></li>
</ul>
<h1 id="generate-keys-for-wireguard">Generate keys for WireGuard</h1>
<p>Do everything as root (doas is the equivalent of sudo):</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">doas su
</span></code></pre>
<p>Move to the wireguard configuration, I'll store everything there for easy access:</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#b57614;">cd</span><span style="color:#282828;"> /etc/wireguard/
</span></code></pre>
<p>Generate the private and public key, store them in files (we'll use them later):</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">wg genkey </span><span style="color:#b23c15;">| </span><span style="color:#282828;">tee philt3r-privatekey </span><span style="color:#b23c15;">| </span><span style="color:#282828;">wg pubkey </span><span style="color:#b23c15;">&gt;</span><span style="color:#282828;"> philt3r-publickey
</span></code></pre>
<h1 id="configure-server-interface">Configure server interface</h1>
<p>All the server configuration will happen in</p>
<pre style="background-color:#fcf0ca;color:#282828aa;"><code><span>/etc/wireguard/wg0.conf
</span></code></pre>
<p>Protip for vim users: To add content of a file in current buffer directly: <a href="https://stackoverflow.com/a/19087947/4809297">StackOverflow answer</a></p>
<pre data-lang="ini" style="background-color:#fcf0ca;color:#282828aa;" class="language-ini "><code class="language-ini" data-lang="ini"><span style="color:#9d0006;">[Interface]
</span><span style="font-style:italic;color:#928374;"># Name = wg0
</span><span style="color:#282828;">Address </span><span style="color:#b23c15;">= </span><span style="color:#282828;">10.131.111.1/24
</span><span style="color:#282828;">ListenPort </span><span style="color:#b23c15;">= </span><span style="color:#8f3f71;">51820
</span><span style="color:#282828;">PrivateKey </span><span style="color:#b23c15;">= &lt;</span><span>server</span><span style="color:#b23c15;">-</span><span>private</span><span style="color:#b23c15;">-</span><span>key</span><span style="color:#b23c15;">&gt;
</span><span style="color:#282828;">PostUp </span><span style="color:#b23c15;">=</span><span> iptables </span><span style="color:#b23c15;">-</span><span>t nat </span><span style="color:#b23c15;">-</span><span style="color:#b57614;">A POSTROUTING </span><span style="color:#b23c15;">-</span><span>s </span><span style="color:#282828;">10.131.111.0/24 </span><span style="color:#b23c15;">-</span><span>o </span><span style="color:#9d0006;">%i </span><span style="color:#b23c15;">-</span><span>j </span><span style="color:#b57614;">MASQUERADE</span><span>;
</span><span style="color:#282828;">PostUp </span><span style="color:#b23c15;">=</span><span> iptables </span><span style="color:#b23c15;">-</span><span>t nat </span><span style="color:#b23c15;">-</span><span style="color:#b57614;">A POSTROUTING </span><span style="color:#b23c15;">-</span><span>s </span><span style="color:#282828;">10.131.110.0/24 </span><span style="color:#b23c15;">-</span><span>o </span><span style="color:#9d0006;">%i </span><span style="color:#b23c15;">-</span><span>j </span><span style="color:#b57614;">MASQUERADE</span><span>;
</span><span style="color:#282828;">PostUp </span><span style="color:#b23c15;">=</span><span> iptables </span><span style="color:#b23c15;">-</span><span style="color:#b57614;">A INPUT </span><span style="color:#b23c15;">-</span><span>p udp </span><span style="color:#b23c15;">-</span><span>m udp </span><span style="color:#b23c15;">--</span><span>dport </span><span style="color:#8f3f71;">51820 </span><span style="color:#b23c15;">-</span><span>j </span><span style="color:#b57614;">ACCEPT</span><span>;
</span><span style="color:#282828;">PostUp </span><span style="color:#b23c15;">=</span><span> iptables </span><span style="color:#b23c15;">-</span><span style="color:#b57614;">A FORWARD </span><span style="color:#b23c15;">-</span><span>i </span><span style="color:#9d0006;">%i </span><span style="color:#b23c15;">-</span><span>j </span><span style="color:#b57614;">ACCEPT</span><span>;
</span><span style="color:#282828;">PostUp </span><span style="color:#b23c15;">=</span><span> iptables </span><span style="color:#b23c15;">-</span><span style="color:#b57614;">A FORWARD </span><span style="color:#b23c15;">-</span><span>o </span><span style="color:#9d0006;">%i </span><span style="color:#b23c15;">-</span><span>j </span><span style="color:#b57614;">ACCEPT</span><span>;
</span><span style="color:#282828;">PostDown </span><span style="color:#b23c15;">=</span><span> iptables </span><span style="color:#b23c15;">-</span><span>t nat </span><span style="color:#b23c15;">-</span><span style="color:#b57614;">D POSTROUTING </span><span style="color:#b23c15;">-</span><span>s </span><span style="color:#282828;">10.131.111.0/24 </span><span style="color:#b23c15;">-</span><span>o </span><span style="color:#9d0006;">%i </span><span style="color:#b23c15;">-</span><span>j </span><span style="color:#b57614;">MASQUERADE</span><span>;
</span><span style="color:#282828;">PostDown </span><span style="color:#b23c15;">=</span><span> iptables </span><span style="color:#b23c15;">-</span><span>t nat </span><span style="color:#b23c15;">-</span><span style="color:#b57614;">D POSTROUTING </span><span style="color:#b23c15;">-</span><span>s </span><span style="color:#282828;">10.131.110.0/24 </span><span style="color:#b23c15;">-</span><span>o </span><span style="color:#9d0006;">%i </span><span style="color:#b23c15;">-</span><span>j </span><span style="color:#b57614;">MASQUERADE</span><span>;
</span><span style="color:#282828;">PostDown </span><span style="color:#b23c15;">=</span><span> iptables </span><span style="color:#b23c15;">-</span><span style="color:#b57614;">D INPUT </span><span style="color:#b23c15;">-</span><span>p udp </span><span style="color:#b23c15;">-</span><span>m udp </span><span style="color:#b23c15;">--</span><span>dport </span><span style="color:#8f3f71;">51820 </span><span style="color:#b23c15;">-</span><span>j </span><span style="color:#b57614;">ACCEPT</span><span>;
</span><span style="color:#282828;">PostDown </span><span style="color:#b23c15;">=</span><span> iptables </span><span style="color:#b23c15;">-</span><span style="color:#b57614;">D FORWARD </span><span style="color:#b23c15;">-</span><span>i </span><span style="color:#9d0006;">%i </span><span style="color:#b23c15;">-</span><span>j </span><span style="color:#b57614;">ACCEPT</span><span>;
</span><span style="color:#282828;">PostDown </span><span style="color:#b23c15;">=</span><span> iptables </span><span style="color:#b23c15;">-</span><span style="color:#b57614;">D FORWARD </span><span style="color:#b23c15;">-</span><span>o </span><span style="color:#9d0006;">%i </span><span style="color:#b23c15;">-</span><span>j </span><span style="color:#b57614;">ACCEPT</span><span>;
</span></code></pre>
<p>Once it's good, make sure only root can read and write to the files:</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">chmod 600 /etc/wireguard/</span><span style="color:#b23c15;">*
</span></code></pre>
<h1 id="add-new-peer">Add new peer</h1>
<p>You will need to repeat this for each new peer</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#b57614;">cd</span><span style="color:#282828;"> /etc/wireguard/
</span></code></pre>
<h2 id="generate-keys">Generate keys</h2>
<p>Starting now, <code>name</code> is a placeholder for the name of the peer.</p>
<p>I typically use the format <strong>name-of-person</strong> followed by <strong>device-name</strong>. For example, the peer for my phone will be <strong>phil-iphone</strong>.</p>
<p>Create folder to store keys for the peer:</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">mkdir -p peers/name
</span></code></pre>
<p>Generate preshared key (not required):</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">wg genpsk </span><span style="color:#b23c15;">| </span><span style="color:#282828;">tee peers/name/preshared.psk
</span></code></pre>
<p>Generate private and public keys for the peer:</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">wg genkey </span><span style="color:#b23c15;">| </span><span style="color:#282828;">tee peers/name/private.key </span><span style="color:#b23c15;">| </span><span style="color:#282828;">wg pubkey </span><span style="color:#b23c15;">&gt;</span><span style="color:#282828;"> peers/name/public.key
</span></code></pre>
<h2 id="update-server-configuration">Update server configuration</h2>
<p>Edit your <code>wg0.conf</code>, add at the bottom:</p>
<pre data-lang="ini" style="background-color:#fcf0ca;color:#282828aa;" class="language-ini "><code class="language-ini" data-lang="ini"><span style="color:#9d0006;">[Peer]
</span><span style="font-style:italic;color:#928374;"># Name = name
</span><span style="color:#282828;">PublicKey </span><span style="color:#b23c15;">= &lt;</span><span>peers</span><span style="color:#b23c15;">/</span><span>name</span><span style="color:#b23c15;">/</span><span>public</span><span style="color:#b23c15;">.</span><span>key</span><span style="color:#b23c15;">&gt;
</span><span style="color:#282828;">PresharedKey </span><span style="color:#b23c15;">= &lt;</span><span>peers</span><span style="color:#b23c15;">/</span><span>name</span><span style="color:#b23c15;">/</span><span>preshared</span><span style="color:#b23c15;">.</span><span>psk</span><span style="color:#b23c15;">&gt;
</span><span style="color:#282828;">AllowedIPs </span><span style="color:#b23c15;">= </span><span style="color:#282828;">10.131.111.2/32
</span><span style="color:#282828;">AllowedIPs </span><span style="color:#b23c15;">= </span><span style="color:#282828;">10.131.110.0/24
</span><span style="color:#282828;">AllowedIPs </span><span style="color:#b23c15;">= </span><span style="color:#282828;">10.131.111.0/24
</span></code></pre>
<h2 id="peer-configuration">Peer configuration</h2>
<p>Now let's create the configuration to give to the peer:</p>
<p>Create the file</p>
<pre style="background-color:#fcf0ca;color:#282828aa;"><code><span>peers/name/philt3r-name.wg.conf
</span></code></pre>
<p>And put the following</p>
<pre data-lang="ini" style="background-color:#fcf0ca;color:#282828aa;" class="language-ini "><code class="language-ini" data-lang="ini"><span style="color:#9d0006;">[Interface]
</span><span style="color:#282828;">PrivateKey </span><span style="color:#b23c15;">= &lt;</span><span>peers</span><span style="color:#b23c15;">/</span><span>name</span><span style="color:#b23c15;">/</span><span>private</span><span style="color:#b23c15;">.</span><span>key</span><span style="color:#b23c15;">&gt;
</span><span style="color:#282828;">Address </span><span style="color:#b23c15;">= </span><span style="color:#282828;">10.131.111.2/24
</span><span style="font-style:italic;color:#928374;">#DNS = 10.131.111.1
</span><span>
</span><span style="color:#9d0006;">[Peer]
</span><span style="color:#282828;">PublicKey </span><span style="color:#b23c15;">= &lt;</span><span>server</span><span style="color:#b23c15;">-</span><span>public</span><span style="color:#b23c15;">-</span><span>key</span><span style="color:#b23c15;">&gt;
</span><span style="color:#282828;">PresharedKey </span><span style="color:#b23c15;">= &lt;</span><span>peers</span><span style="color:#b23c15;">/</span><span>name</span><span style="color:#b23c15;">/</span><span>preshared</span><span style="color:#b23c15;">.</span><span>psk</span><span style="color:#b23c15;">&gt;
</span><span style="color:#282828;">Endpoint </span><span style="color:#b23c15;">= &lt;</span><span>server</span><span style="color:#b23c15;">-</span><span>ip</span><span style="color:#b23c15;">&gt;:</span><span style="color:#8f3f71;">51820
</span><span style="color:#282828;">AllowedIPs </span><span style="color:#b23c15;">= </span><span style="color:#282828;">10.131.110.0/24
</span><span style="color:#282828;">AllowedIPS </span><span style="color:#b23c15;">= </span><span style="color:#282828;">10.131.111.0/24
</span><span style="color:#282828;">PersistentKeepalive </span><span style="color:#b23c15;">= </span><span style="color:#8f3f71;">25
</span></code></pre>
<p>DNS info is not used yet, it's normal, I will enable it once my DNS server will be created (not in this blog post though).</p>
<h2 id="distribute-config">Distribute config</h2>
<p>Either give the configuration file we just created, or you can have multiple choices.</p>
<h3 id="qr-code">QR Code</h3>
<p>Start by installing</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">apk add libqrencode-tools
</span></code></pre>
<p>And run </p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">qrencode -t ansiutf8 </span><span style="color:#b23c15;">&lt;</span><span style="color:#282828;"> peers/name/philt3r-name.wg.conf
</span></code></pre>
<h3 id="base64">Base64</h3>
<p>Note: I'm using <code>base64</code> on Alpine, which comes from BusyBox, the CLI may be different depending on the operating system you're using.</p>
<p>Encode the configuration file to a base64 string:</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">cat philt3r-name.wg.conf </span><span style="color:#b23c15;">| </span><span style="color:#282828;">base64 -w 0
</span></code></pre>
<p>And on the other device, decode the string and save to a file:</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">base64 -d </span><span style="color:#b23c15;">&gt;</span><span style="color:#282828;"> philt3r-name.wg.conf
</span></code></pre>
<p>Put the base64 encoded string, and send a EOF (usually <code>ctrl + d</code>).</p>
<h2 id="restart-wireguard">Restart WireGuard</h2>
<p>If you already have WireGuard running, simply run</p>
<pre style="background-color:#fcf0ca;color:#282828aa;"><code><span>rc-service wg restart
</span></code></pre>
<p>to restart the server with your new peer.</p>
<h1 id="start-wireguard-manually">Start WireGuard manually</h1>
<p>Make sure to open the port on your router in <strong>UDP</strong> mode! I spent a lot of time debugging to realize that my port was in TCP, double check!</p>
<p>Make sure to be root before, don't use <code>doas</code> or <code>sudo</code>!</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">wg-quick up wg0
</span></code></pre>
<p>On the peer, start the tunnel.</p>
<p>On the server, run</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">wg
</span></code></pre>
<p>to check the status of WireGuard. You should see the peer and some stats it is connected.</p>
<p>If you do not see info about the peer even if it is not connected, that means you did something wrong in the configuration!</p>
<p>From your peer, you should be able to ping the WireGuard internal IP:</p>
<pre style="background-color:#fcf0ca;color:#282828aa;"><code><span>10.131.111.1
</span></code></pre>
<ul>
<li>iOS: <a href="https://apps.apple.com/fr/app/ping-network-utility/id576773404">Ping</a></li>
<li>OSX / Linux: <code>ping</code></li>
</ul>
<p>If you can ping the ip, you're good!</p>
<p>You may not be able to go on the internet, or even make DNS requests, it's normal.</p>
<p>We are just testing if the tunnel works. You can stop the tunnel.</p>
<h1 id="stop-wireguard-manually">Stop WireGuard manually</h1>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">wg-quick down wg0
</span></code></pre>
<h1 id="script-to-launch-on-server-startup">Script to launch on server startup</h1>
<p>To start WireGuard on startup, we will write an OpenRC script. It will be located in</p>
<pre style="background-color:#fcf0ca;color:#282828aa;"><code><span>/etc/init.d/wg
</span></code></pre>
<p>Put the following:</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="font-style:italic;color:#928374;">#!/sbin/openrc-run
</span><span style="font-style:italic;color:#928374;">#
</span><span>
</span><span style="color:#282828;">description</span><span style="color:#b23c15;">=</span><span style="color:#79740e;">&quot;WireGuard&quot;
</span><span>
</span><span style="color:#407959;">depend</span><span>() {
</span><span>    </span><span style="color:#282828;">need localmount net sysctl
</span><span>    </span><span style="color:#282828;">after bootmisc
</span><span>}
</span><span>
</span><span style="color:#407959;">start</span><span>() {
</span><span>    </span><span style="color:#282828;">ebegin </span><span style="color:#79740e;">&quot;Starting WireGuard&quot;
</span><span>    </span><span style="color:#282828;">wg-quick up wg0
</span><span>    </span><span style="color:#282828;">eend $?
</span><span>}
</span><span>
</span><span style="color:#407959;">stop</span><span>() {
</span><span>    </span><span style="color:#282828;">ebegin </span><span style="color:#79740e;">&quot;Stopping WireGuard&quot;
</span><span>    </span><span style="color:#282828;">wg-quick down wg0
</span><span>    </span><span style="color:#282828;">eend $?
</span><span>}
</span><span>
</span><span style="color:#407959;">status</span><span>() {
</span><span>    </span><span style="color:#282828;">wg show wg0
</span><span>}
</span></code></pre>
<p>Give it executable access</p>
<pre data-lang="sh" style="background-color:#fcf0ca;color:#282828aa;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#282828;">chmod +x /etc/init.d/wg
</span></code></pre>
<h2 id="manual">Manual</h2>
<ul>
<li>Start: <code>rc-service wg start</code></li>
<li>Stop: <code>rc-service wg stop</code></li>
<li>Restart: <code>rc-service wg restart</code></li>
<li>Status: <code>rc-service wg status</code></li>
</ul>
<h2 id="startup">Startup</h2>
<ul>
<li>Add at startup: <code>rc-update add wg</code></li>
<li>Remove from startup: <code>rc-update del wg</code></li>
<li>Show services at startup: <code>rc-status</code></li>
</ul>
<p>Reboot and make sure everything works, you should see WireGuard logs when your server is starting.</p>
<h1 id="resources">Resources</h1>
<p>These resources helped me when setting up my WireGuard server. Thanks!</p>
<ul>
<li><a href="https://github.com/pirate/wireguard-docs">https://github.com/pirate/wireguard-docs</a></li>
<li><a href="https://blog.ruanbekker.com/blog/2020/01/11/setup-a-wireguard-vpn-server-on-linux/">https://blog.ruanbekker.com/blog/2020/01/11/setup-a-wireguard-vpn-server-on-linux/</a></li>
<li><a href="https://try.popho.be/wg.html">https://try.popho.be/wg.html</a></li>
</ul>

</article>


      
      <footer role="contentinfo">
        <hr />
        
        <nav style="margin-bottom:1rem;" role="navigation">
          
            <a href="https://blog.x4m3.rocks/atom.xml">RSS</a>
            
              <span>&middot;</span>
            
          
            <a href="https://philippeloctaux.com">Website</a>
            
          
        </nav>
        
        
        
      </footer>
      

    </main>
    
    

    <script type="text/javascript" src="https://blog.x4m3.rocks/elasticlunr.min.js"></script>
    <script type="text/javascript" src="https://blog.x4m3.rocks/search.js"></script>
  </body>
</html>

